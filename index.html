<!doctype html>
<html>
	<head>
		<script src="https://cdn.jsdelivr.net/pyodide/v0.26.0/full/pyodide.js"></script>
	</head>

	<body>
		<h1>THE GREAT DISCORD DATA ANALYZER</h1>
		<p>
		SELECT A FILE AND PRESS A BUTTON
		</p>
		<!-- <input id="code" value="sum([1, 2, 3, 4, 5])" /> -->
		<label for="myfile">Select a file:</label>
		<input type="file" id="myfile" name="myfile">
		<br />
		<br />
		<button id="runbutton">CRUNCH THE DATA</button>
		<br />
		<button onclick="evaluatePython()"">Eval python again?</button>
		<p>Program output:</p>
		<div style="border:2px inset #AAA;cursor:text;height:120px;overflow:auto;width:600px; resize:both">
			<div id="content">
			</div>
		</div>
		<div>Some Other Output:</div>
		<textarea id="output" style="width: 100%;" rows="6" disabled></textarea>

		<script>
			const output = document.getElementById("output");
			// const code = document.getElementById("code");

			function addToOutput(s) {
				// output.value += ">>>" + code.value + "\n" + s + "\n";
				output.value += "\n" + s + "\n";
			}

			output.value = "Initializing...\n";
			// init Pyodide
			async function main() {
				let pyodide = await loadPyodide();
				await pyodide.loadPackage("micropip");
				const micropip = pyodide.pyimport("micropip");
				await micropip.install("matplotlib");
				// await micropip.install("pandas");
				output.value += "Ready!\n";
				return pyodide;
			}
			let pyodideReadyPromise = main();

			evaluatePython()

			async function evaluatePython() {
				let pyodide = await pyodideReadyPromise;
				try {
					// let output = pyodide.runPython(code.value);
					let output = pyodide.runPython(await (await fetch("/script.py")).text())
					addToOutput(output);

				} catch (err) {
					addToOutput(err);
				}
			}
		</script>
	</body>
</html>
